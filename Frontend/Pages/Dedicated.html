<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Post</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body{
            margin: 0;
            height: 100vh;
            background: linear-gradient(135deg, #FF9BEF, #6A42D9);
            display: flex;
            justify-content: center;
            align-items: center;
            font-family: italic,sans-serif;
        }
        .post{
          width: 550px;
          border: 1px gray solid;
          margin: 40px auto;
          border-radius: 10px;
          padding: 20px;
        }
        .btn-edit{
            background-color: #4b8df8;
            color: white;
        }
        .btn-delete{
            background-color: #e74c3c;
            color: white;
        }
        .btn-edit:hover{
            background: linear-gradient(45deg, #FF6FD8, #3813C2);
        }
        .btn-delete:hover{
            background: linear-gradient(45deg, #FF6FD8, #3813C2);
        }
    </style>
  </head>

  <body>
    <div class="post">
      <h1 id="title">Loading...</h1>
      <p id="description"></p>

      <div class="d-flex gap-3 mt-4">
        <button id="editBtn" class="btn btn-edit w-50">Edit Post</button>
        <button id="deleteBtn" class="btn btn-delete w-50">Delete Post</button>
      </div>

      <!-- Hidden Edit Form -->
      <div id="editForm" style="display:none; margin-top:20px;">
        <input id="editTitle" class="form-control mb-2" placeholder="Title">
        <textarea id="editDesc" class="form-control mb-2" rows="5"></textarea>
        <button id="saveEditBtn" class="btn btn-success w-100">Save Changes</button>
      </div>
    </div>

    <script>
        const params = new URLSearchParams(window.location.search);
        const postID = params.get("postID");
        const loggedInUser = localStorage.getItem("userID");

        // Load post
        fetch(`http://localhost:3000/getPostById?postID=${postID}`)
            .then(res => res.json())
            .then(post => {
                if (!post) {
                    document.getElementById("title").innerText = "Post Not Found";
                    return;
                }

                // Display post
                document.getElementById("title").innerText = post.postTitle;
                document.getElementById("description").innerText = post.postDescription;

                // If someone elseâ€™s post -> hide edit/delete
                if (String(post.UserID) !== String(loggedInUser)) {
                    document.getElementById("editBtn").style.display = "none";
                    document.getElementById("deleteBtn").style.display = "none";
                }
            });


        // Delete Post
        document.getElementById("deleteBtn").onclick = () => {
            if (!confirm("Are you sure you want to delete this post?")) return;

            fetch("http://localhost:3000/deletePost", {
                method: "DELETE",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                    postID,
                    userID: loggedInUser
                })
            })
            .then(res => res.text())
            .then(msg => {
                alert(msg);
                window.location.href = "/Frontend/Pages/Feed.html";
            });
        };


        // Edit button open form
        document.getElementById("editBtn").onclick = () => {
            document.getElementById("editForm").style.display = "block";
            document.getElementById("editTitle").value = document.getElementById("title").innerText;
            document.getElementById("editDesc").value = document.getElementById("description").innerText;
        };

        // Save Edited Post
        document.getElementById("saveEditBtn").onclick = () => {
            const newTitle = document.getElementById("editTitle").value;
            const newDesc = document.getElementById("editDesc").value;

            fetch("http://localhost:3000/editPost", {
                method: "PUT",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                    postID,
                    postTitle: newTitle,
                    postDescription: newDesc,
                    userID: loggedInUser
                })
            })
            .then(res => res.text())
            .then(msg => {
                alert(msg);
                location.reload(); // refresh page to load updated content
            });
        };
    </script>

  </body>
</html>
