<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>View Post</title>
  <style>
    /* Basic Reset */
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: Arial, sans-serif;
    }

    body {
      background-color: #f5f5f5;
      color: #333;
      padding: 20px;
      transition: background 0.3s, color 0.3s;
    }

    body.dark {
      background-color: #121212;
      color: #f5f5f5;
    }

    .container {
      max-width: 800px;
      margin: 0 auto;
      background: #fff;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
      transition: background 0.3s, color 0.3s;
    }

    body.dark .container {
      background: #1e1e1e;
      color: #f5f5f5;
    }

    h1 {
      font-size: 2rem;
      margin-bottom: 15px;
    }

    p {
      font-size: 1.1rem;
      line-height: 1.6;
      margin-bottom: 20px;
      white-space: pre-wrap;
    }

    .buttons {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
    }

    .buttons button {
      padding: 10px 20px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 1rem;
    }

    #editBtn { background-color: #4CAF50; color: white; }
    #deleteBtn { background-color: #f44336; color: white; }

    #editForm {
      display: none;
      flex-direction: column;
      gap: 10px;
      margin-top: 20px;
    }

    #editForm input, #editForm textarea {
      width: 100%;
      padding: 10px;
      border-radius: 5px;
      border: 1px solid #ccc;
      font-size: 1rem;
    }

    #saveEditBtn {
      background-color: #2196F3;
      color: white;
      padding: 10px 20px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }

    /* Theme toggle button */
    #themeToggle {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 8px 15px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 1.2rem;
      background-color: #333;
      color: #fff;
      z-index: 1000;
      transition: background 0.3s, color 0.3s;
    }

    body.dark #themeToggle {
      background-color: #f5f5f5;
      color: #121212;
    }

    /* Responsive */
    @media (max-width: 600px) {
      .container {
        padding: 20px;
      }
      h1 { font-size: 1.5rem; }
      .buttons { flex-direction: column; }
      .buttons button { width: 100%; }
      #saveEditBtn { width: 100%; }
    }
  </style>
</head>
<body>

  <button id="themeToggle">ðŸŒ™</button>

  <div class="container">
    <h1 id="title">Loading...</h1>
    <p id="description"></p>

    <div class="buttons">
      <button id="editBtn">Edit</button>
      <button id="deleteBtn">Delete</button>
    </div>

    <div id="editForm">
      <input type="text" id="editTitle" placeholder="Post Title">
      <textarea id="editDesc" rows="6" placeholder="Post Description"></textarea>
      <button id="saveEditBtn">Save Changes</button>
    </div>
  </div>

  <script>
    const params = new URLSearchParams(window.location.search);
    const postID = params.get("postID");
    const loggedInUser = localStorage.getItem("userID");

    const titleEl = document.getElementById("title");
    const descEl = document.getElementById("description");
    const editBtn = document.getElementById("editBtn");
    const deleteBtn = document.getElementById("deleteBtn");
    const editForm = document.getElementById("editForm");
    const editTitle = document.getElementById("editTitle");
    const editDesc = document.getElementById("editDesc");
    const saveEditBtn = document.getElementById("saveEditBtn");
    const themeToggle = document.getElementById("themeToggle");
    const bodyEl = document.body;

    // Load saved theme
    const savedTheme = localStorage.getItem("theme");
    if (savedTheme === "dark") {
      bodyEl.classList.add("dark");
      themeToggle.textContent = "â˜€ï¸";
    }

    // Theme toggle button
    themeToggle.addEventListener("click", () => {
      bodyEl.classList.toggle("dark");
      const isDark = bodyEl.classList.contains("dark");
      themeToggle.textContent = isDark ? "â˜€ï¸" : "ðŸŒ™";
      localStorage.setItem("theme", isDark ? "dark" : "light");
    });

    // Fetch post
    fetch(`http://localhost:3000/getPostById?postID=${postID}`)
      .then(res => res.json())
      .then(post => {
        if (!post || post.error) {
          titleEl.innerText = "Post Not Found";
          descEl.innerText = "";
          editBtn.style.display = "none";
          deleteBtn.style.display = "none";
          return;
        }

        titleEl.innerText = post.postTitle;
        descEl.innerText = post.postDescription;

        // Show buttons only to owner
        if (post.userID !== loggedInUser) {
          editBtn.style.display = "none";
          deleteBtn.style.display = "none";
        }
      })
      .catch(err => {
        console.error(err);
        titleEl.innerText = "Error loading post";
        descEl.innerText = "";
      });

    // Delete
    deleteBtn.onclick = () => {
      if (!confirm("Are you sure you want to delete this post?")) return;

      fetch("http://localhost:3000/deletePost", {
        method: "DELETE",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ postID, userID: loggedInUser })
      })
      .then(res => res.text())
      .then(msg => {
        alert(msg);
        window.location.href = "Feed.html";
      })
      .catch(err => alert("Error deleting post"));
    };

    // Edit
    editBtn.onclick = () => {
      editForm.style.display = "flex";
      editTitle.value = titleEl.innerText;
      editDesc.value = descEl.innerText;
    };

    saveEditBtn.onclick = () => {
      const newTitle = editTitle.value.trim();
      const newDesc = editDesc.value.trim();

      if (!newTitle || !newDesc) return alert("Title and description cannot be empty");

      fetch("http://localhost:3000/editPost", {
        method: "PUT",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ postID, postTitle: newTitle, postDescription: newDesc, userID: loggedInUser })
      })
      .then(res => res.text())
      .then(msg => {
        alert(msg);
        location.reload();
      })
      .catch(err => alert("Error saving changes"));
    };
  </script>

</body>
</html>
